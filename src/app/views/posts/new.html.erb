<h1>新規投稿</h1>
<!-- form_for部分 -->

<%= form_for(@post) do |f| %>

  <h4>タイトル</h4>
  <%= f.text_field :title %>

  <h4>カテゴリー</h4>
  <%= f.text_field :category %>

  <h4>本文</h4>
  <%= f.text_area :body %>

  <div id="container">
    <div id="draggableArea">
        <div class="drag-and-drop" id="draggable"><i class="fas fa-tshirt fa-tshirt"></i></div>
        <div class="drag-and-drop" id="draggable"><i class="fas fa-tshirt clip-others-barca-02"></i></div>
        <div class="drag-and-drop" id="draggable"><i class="fas fa-tshirt clip-others-barca-03"></i></div>
    </div>
  </div>

  <canvas id="canvas" width=300 height=300></canvas>

  <%= f.submit '投稿' %>

<script>
window.onload=function(){

var canvas=document.getElementById("canvas");
var ctx=canvas.getContext("2d");
var BB=canvas.getBoundingClientRect();
var offsetX=BB.left;
var offsetY=BB.top;
var WIDTH = canvas.width;
var HEIGHT = canvas.height;
var dragok = false;
var startX;
var startY;

var rects = [];
rects.push({
    x: 220 - 10,
    y: 90 - 35,
    fill: "#444444",
    isDragging: false
});
rects.push({
    x: 140 - 10,
    y: 50 - 35,
    width: 30,
    height: 30,
    fill: "#ff550d",
    isDragging: false
});
rects.push({
    x: 60 - 10,
    y: 90 - 35,
    width: 30,
    height: 30,
    fill: "#800080",
    isDragging: false
});
rects.push({
    x: 100 - 10,
    y: 150 - 35,
    width: 30,
    height: 30,
    fill: "#0c64e8",
    isDragging: false
});
rects.push({
    x: 180 - 10,
    y: 150 - 35,
    width: 30,
    height: 30,
    fill: "#0c64e8",
    isDragging: false
});
rects.push({
    x: 140 - 10,
    y: 200 - 35,
    width: 30,
    height: 30,
    fill: "#0c64e8",
    isDragging: false
});
rects.push({
    x: 100 - 10,
    y: 250 - 35,
    width: 30,
    height: 30,
    fill: "#0c64e8",
    isDragging: false
});
rects.push({
    x: 180 - 10,
    y: 250 - 35,
    width: 30,
    height: 30,
    fill: "#0c64e8",
    isDragging: false
});
rects.push({
    x: 30 - 10,
    y: 220 - 35,
    width: 30,
    height: 30,
    fill: "#0c64e8",
    isDragging: false
});
rects.push({
    x: 260 - 10,
    y: 220 - 35,
    width: 30,
    height: 30,
    fill: "#0c64e8",
    isDragging: false
});


canvas.onmousedown = myDown;
canvas.onmouseup = myUp;
canvas.onmousemove = myMove;

draw();

function rect(x,y,w,h) {
 ctx.beginPath();
 ctx.rect(x,y,w,h);
 ctx.closePath();
 ctx.fill();
}

function clear() {
 ctx.clearRect(0, 0, WIDTH, HEIGHT);
}

function draw() {
    clear();
    ctx.fillStyle = "#FAF7F8";
    rect(0,0,WIDTH,HEIGHT);
    // redraw each rects in the rects[] array
    for(var i=0;i<rects.length;i++){
        var r=rects[i];
        ctx.fillStyle=r.fill;
        rect(r.x,r.y,r.width,r.height);
    }
}

function myDown(e){


    e.preventDefault();
    e.stopPropagation();

    var mx=parseInt(e.clientX-offsetX);
    var my=parseInt(e.clientY-offsetY);

    dragok=false;
    for(var i=0;i<rects.length;i++){
        var r=rects[i];
        if(mx>r.x && mx<r.x+r.width && my>r.y && my<r.y+r.height){

            dragok=true;
            r.isDragging=true;
        }
    }
    startX=mx;
    startY=my;
}

function myUp(e){

    e.preventDefault();
    e.stopPropagation();

    dragok = false;
    for(var i=0;i<rects.length;i++){
        rects[i].isDragging=false;
    }
}

function myMove(e){
    if (dragok){

      e.preventDefault();
      e.stopPropagation();

      var mx=parseInt(e.clientX-offsetX);
      var my=parseInt(e.clientY-offsetY);

      var dx=mx-startX;
      var dy=my-startY;

      for(var i=0;i<rects.length;i++){
          var r=rects[i];
          if(r.isDragging){
              r.x+=dx;
              r.y+=dy;
          }
      }

      draw();

      startX=mx;
      startY=my;

    }
}

};
</script>

<% end %>